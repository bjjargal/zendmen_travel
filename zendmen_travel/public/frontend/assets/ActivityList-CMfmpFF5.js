var Q=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var S=(l,t,a)=>t in l?Q(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,I=(l,t)=>{for(var a in t||(t={}))Y.call(t,a)&&S(l,a,t[a]);if(F)for(var a of F(t))Z.call(t,a)&&S(l,a,t[a]);return l},N=(l,t)=>W(l,X(t));var h=(l,t,a)=>new Promise((m,d)=>{var f=o=>{try{_(a.next(o))}catch(b){d(b)}},p=o=>{try{_(a.throw(o))}catch(b){d(b)}},_=o=>o.done?m(o.value):Promise.resolve(o.value).then(f,p);_((a=a.apply(l,t)).next())});import{A as ee}from"./Activities-DqFPjuRy.js";import{D as te}from"./destinations-4f1sDCIz.js";import{m as ae,r as y,K as ne,B as r,c as w,o as x,b as s,w as u,f as se,d as E,t as oe,e as ie,u as P,F as le,H as ce,D as v}from"./index-DDp1eRUk.js";const re={key:0},ue={key:1,class:"editable-row-operations"},de={class:"flex gap-2"},ye={__name:"ActivityList",setup(l){const{destinations:t}=te(),a=ae(()=>{var n;return((n=t==null?void 0:t.data)==null?void 0:n.map(e=>({value:e.name,label:e.destination_name})))||[]}),{activities:m}=ee(),d=y(!1),f=y(!1),p=y(!1),_=y(""),o=ne({doctype:"Activity",name:_,auto:!1}),b=y(null),i=y(null),U={activity_name:[{required:!0,message:"Please enter activity name"}],cost:[{required:!0,message:"Please enter cost"},{type:"number",min:0,message:"Cost must be at least 0"}],destinations:[{required:!0,type:"array",min:1,message:"Please select at least one destination"}]},B=()=>h(this,null,function*(){try{p.value=!0,i.value=ce({activity_name:"",cost:0,destinations:[]}),d.value=!0}catch(n){console.error("Setup create error:",n)}}),R=n=>h(this,null,function*(){try{p.value=!1,_.value=n,o.name=n,yield o.reload(),i.value=o.doc,i.value.destinations=o.doc.destination_child.map(e=>e.destination),d.value=!0}catch(e){v.error({content:e.message,duration:5})}}),V=()=>{d.value=!1},$=()=>h(this,null,function*(){try{if(f.value=!0,p.value){const n=i.value.destinations.map(e=>({destination:e}));yield m.insert.submit(N(I({},i.value),{destination_child:n})),v.success("Activity created successfully",2)}else o.doc.destination_child.splice(0,o.doc.destination_child.length),i.value.destinations.forEach(n=>{o.doc.destination_child.push({destination:n})}),yield o.save.submit(),v.success("Activity updated successfully",2);yield m.reload(),d.value=!1}catch(n){n.errorFields?v.error("Please fix the errors below",2):(v.error("Failed to save activity",2),console.error("Save error:",n))}finally{f.value=!1}}),q=n=>h(this,null,function*(){try{yield m.delete.submit(n),yield m.reload(),v.success("Successfully deleted activity",2)}catch(e){v.error(e.message||"Failed to delete activity",2)}}),z=[{title:"Activity name",key:"activity_name",dataIndex:"activity_name"},{title:"Cost",key:"cost",dataIndex:"cost",width:"25%"},{title:"Description",key:"description",dataIndex:"description"},{title:"Action",key:"Action",width:"15%"}];return(n,e)=>{var D;const C=r("a-button"),j=r("a-page-header"),A=r("FeatherIcon"),O=r("a-table"),T=r("a-input"),g=r("a-form-item"),H=r("a-input-number"),K=r("a-textarea"),L=r("a-select"),M=r("a-form"),G=r("a-modal");return x(),w(le,null,[s(j,{class:"!p-0 !mb-2",title:"Activities"},{extra:u(()=>[s(C,{type:"primary",onClick:B},{default:u(()=>[...e[5]||(e[5]=[se("Create activity",-1)])]),_:1})]),_:1}),s(O,{columns:z,"data-source":P(m).data,size:"small",loading:P(m).list.loading,pagination:!1,"row-key":"name",scroll:{y:"calc(100vh - 280px)"}},{bodyCell:u(({column:c,record:k})=>[c.dataIndex==="cost"?(x(),w("div",re," $"+oe(k.cost),1)):E("",!0),c.key==="Action"?(x(),w("div",ue,[ie("div",de,[s(C,{onClick:J=>R(k.name),type:"primary",class:"!flex justify-center items-center"},{icon:u(()=>[s(A,{name:"edit",class:"size-4"})]),_:1},8,["onClick"]),s(C,{onClick:J=>q(k.name),type:"primary",class:"!flex justify-center items-center",danger:""},{icon:u(()=>[s(A,{name:"trash-2",class:"size-4"})]),_:1},8,["onClick"])])])):E("",!0)]),_:1},8,["data-source","loading"]),s(G,{open:d.value,"onUpdate:open":e[4]||(e[4]=c=>d.value=c),title:p.value?"Create Activity":`Activity: ${((D=i.value)==null?void 0:D.activity_name)||""}`,onOk:$,loading:f.value,onCancel:V},{default:u(()=>[s(M,{form:b.value,model:i.value,rules:U,layout:"vertical"},{default:u(()=>[s(g,{label:"Activity Name",name:"activity_name"},{default:u(()=>[s(T,{value:i.value.activity_name,"onUpdate:value":e[0]||(e[0]=c=>i.value.activity_name=c),placeholder:"Enter activity name"},null,8,["value"])]),_:1}),s(g,{label:"Cost",name:"cost"},{default:u(()=>[s(H,{value:i.value.cost,"onUpdate:value":e[1]||(e[1]=c=>i.value.cost=c),placeholder:"Enter cost",class:"!w-full"},null,8,["value"])]),_:1}),s(g,{label:"Description",name:"description"},{default:u(()=>[s(K,{value:i.value.description,"onUpdate:value":e[2]||(e[2]=c=>i.value.description=c),placeholder:"Enter cost",class:"!w-full"},null,8,["value"])]),_:1}),s(g,{label:"Destinations",name:"destinations"},{default:u(()=>[s(L,{value:i.value.destinations,"onUpdate:value":e[3]||(e[3]=c=>i.value.destinations=c),options:a.value,mode:"multiple",class:"!w-full",placeholder:"Please select"},null,8,["value","options"])]),_:1})]),_:1},8,["form","model"])]),_:1},8,["open","title","loading"])],64)}}};export{ye as default};
//# sourceMappingURL=ActivityList-CMfmpFF5.js.map
