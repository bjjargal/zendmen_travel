var ve=Object.defineProperty;var L=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var H=(f,s,o)=>s in f?ve(f,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):f[s]=o,B=(f,s)=>{for(var o in s||(s={}))fe.call(s,o)&&H(f,o,s[o]);if(L)for(var o of L(s))ye.call(s,o)&&H(f,o,s[o]);return f};var x=(f,s,o)=>new Promise((I,_)=>{var b=d=>{try{A(o.next(d))}catch(w){_(w)}},h=d=>{try{A(o.throw(d))}catch(w){_(w)}},A=d=>d.done?I(d.value):Promise.resolve(d.value).then(b,h);A((o=o.apply(f,s)).next())});import{D as _e}from"./destinations-4f1sDCIz.js";import{A as ge}from"./Attraction-hOVnGSQ7.js";import{r as m,H as S,K as ke,m as Ce,B as p,c as C,o as v,b as t,w as l,f as F,d as E,u as j,p as K,F as $,t as xe,e as be,D as c,L as Ae}from"./index-DDp1eRUk.js";import{F as we}from"./FileUploader-BhzMGNFW.js";const he={key:0,class:"flex gap-2"},De={key:0},Fe={key:1,class:"flex gap-2"},Ie=["onClick"],Ue=["src"],Ne={key:1,class:"w-full border rounded border-dotted hover:border-blue-500 flex justify-center h-40 items-center bg-gray-50"},Ee={__name:"DestinationList",setup(f){const{destinations:s}=_e(),{attractions:o}=ge(),I=[{value:"Monastery"},{value:"Museum"},{value:"Photo Site"},{value:"Monument"}],_=m(!1);m(!1);const b=m(!1),h=m(!1),A=m(!1),d=m(!1),w=m(""),u=S({}),U=ke({doctype:"Destination",name:w,auto:!1}),G=m(null);m(null);const J=m(null),r=m(null);S({title:"",image:""});const g=S({attraction_name:"",type:""}),Q={destination_name:[{required:!0,message:"Please enter destination name"}]},W={attraction_name:[{required:!0,message:"Please enter attraction name"}],type:[{required:!0,message:"Please select type"}]},P=Ce(()=>{var e;const a=((e=r.value)==null?void 0:e.name)||"";return o.data.filter(y=>y.destination===a)}),X=[{title:"Destination Name",key:"destination_name",dataIndex:"destination_name"},{title:"Action",key:"Action",width:"15%"}],Y=[{title:"Attraction Name",dataIndex:"attraction_name"},{title:"Type",dataIndex:"type"},{title:"Action",key:"Action"}],Z=()=>x(this,null,function*(){d.value=!0,r.value=S({destination_name:"",description:"",images:[]}),_.value=!0}),ee=a=>x(this,null,function*(){try{d.value=!1,w.value=a,U.name=a,yield U.reload(),r.value=U.doc,_.value=!0}catch(e){c.error(e.message)}}),te=a=>x(this,null,function*(){try{yield s.delete.submit(a),yield s.reload(),c.success("Destination deleted successfully")}catch(e){c.error("Failed to delete destination")}}),ae=()=>x(this,null,function*(){try{h.value=!0,d.value?(yield s.insert.submit(B({},r.value)),c.success("Destination created successfully")):(yield U.save.submit(),c.success("Destination updated successfully")),yield s.reload(),_.value=!1}catch(a){c.error(a.message||"Failed to save")}finally{h.value=!1}}),ne=()=>{_.value=!1},oe=()=>{var a;g.attraction_name="",g.type="",g.destination=((a=r.value)==null?void 0:a.name)||"",b.value=!0},le=()=>x(this,null,function*(){try{A.value=!0,yield o.insert.submit(B({},g)),c.success("Attraction created successfully"),yield o.reload(),b.value=!1}catch(a){a.errorFields?c.error("Please fix the errors below"):(c.error("Failed to create attraction"),console.error("Create error:",a))}finally{A.value=!1}}),se=()=>{b.value=!1},ie=a=>{const e=P.value.find(y=>y.name===a);e&&(u[a]=Ae(e))},re=a=>x(this,null,function*(){try{yield o.setValue.submit(u[a]),c.success("Attraction updated"),delete u[a],yield o.reload()}catch(e){c.error("Failed to update")}}),ce=a=>delete u[a],de=a=>x(this,null,function*(){try{yield o.delete.submit(a),yield o.reload(),c.success("Attraction deleted")}catch(e){c.error("Failed to delete attraction")}}),ue=a=>r.value.image=a.file_url;return(a,e)=>{var O;const y=p("a-button"),me=p("a-page-header"),N=p("FeatherIcon"),R=p("a-table"),z=p("a-input"),D=p("a-form-item"),pe=p("a-textarea"),T=p("a-select"),V=p("a-typography-link"),M=p("a-form"),q=p("a-modal");return v(),C($,null,[t(me,{class:"!p-0 !mb-2",title:"Destinations"},{extra:l(()=>[t(y,{type:"primary",onClick:Z},{default:l(()=>[...e[6]||(e[6]=[F("Create destination",-1)])]),_:1})]),_:1}),t(R,{columns:X,"data-source":j(s).data,size:"small",loading:j(s).list.loading,pagination:!1,"row-key":"name",scroll:{y:"calc(100vh - 280px)"}},{bodyCell:l(({column:n,record:i})=>[n.key==="Action"?(v(),C("div",he,[t(y,{onClick:k=>ee(i.name),type:"primary",class:"!flex justify-center items-center"},{icon:l(()=>[t(N,{name:"edit",class:"size-4"})]),_:1},8,["onClick"]),t(y,{onClick:k=>te(i.name),danger:"",type:"primary",class:"!flex justify-center items-center"},{icon:l(()=>[t(N,{name:"trash-2",class:"size-4"})]),_:1},8,["onClick"])])):E("",!0)]),_:1},8,["data-source","loading"]),t(q,{open:_.value,"onUpdate:open":e[5]||(e[5]=n=>_.value=n),width:"50%",title:`Destination: ${((O=r.value)==null?void 0:O.destination_name)||""}`,onOk:ae,loading:h.value,onCancel:ne},{default:l(()=>[t(M,{form:G.value,model:r.value,rules:Q,layout:"vertical"},{default:l(()=>[t(D,{label:"Destination Name",name:"destination_name"},{default:l(()=>[t(z,{value:r.value.destination_name,"onUpdate:value":e[0]||(e[0]=n=>r.value.destination_name=n),placeholder:"Enter destination name"},null,8,["value"])]),_:1}),t(D,{label:"Description",name:"description"},{default:l(()=>[t(pe,{rows:6,value:r.value.description,"onUpdate:value":e[1]||(e[1]=n=>r.value.description=n),placeholder:"Enter description"},null,8,["value"])]),_:1}),t(D,{label:"Attractions"},{default:l(()=>[t(R,{columns:Y,"data-source":P.value,size:"small",loading:j(o).list.loading,pagination:!1,"row-key":"name"},{bodyCell:l(({column:n,record:i})=>[["attraction_name","type"].includes(n.dataIndex)?(v(),C("div",De,[u[i.name]&&n.dataIndex==="attraction_name"?(v(),K(z,{key:0,value:u[i.name][n.dataIndex],"onUpdate:value":k=>u[i.name][n.dataIndex]=k,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):u[i.name]&&n.dataIndex==="type"?(v(),K(T,{key:1,options:I,value:u[i.name][n.dataIndex],"onUpdate:value":k=>u[i.name][n.dataIndex]=k,style:{margin:"-5px 0"}},null,8,["value","onUpdate:value"])):(v(),C($,{key:2},[F(xe(i[n.dataIndex]),1)],64))])):E("",!0),n.key==="Action"?(v(),C("div",Fe,[u[i.name]?(v(),C($,{key:0},[t(V,{onClick:k=>re(i.name)},{default:l(()=>[...e[7]||(e[7]=[F("Save",-1)])]),_:1},8,["onClick"]),t(V,{onClick:k=>ce(i.name)},{default:l(()=>[...e[8]||(e[8]=[F("Cancel",-1)])]),_:1},8,["onClick"])],64)):(v(),C($,{key:1},[t(y,{onClick:k=>ie(i.name),type:"primary",class:"!flex justify-center items-center"},{icon:l(()=>[t(N,{name:"edit",class:"size-4"})]),_:1},8,["onClick"]),t(y,{onClick:k=>de(i.name),danger:"",type:"primary",class:"!flex justify-center items-center"},{icon:l(()=>[t(N,{name:"trash-2",class:"size-4"})]),_:1},8,["onClick"])],64))])):E("",!0)]),_:1},8,["data-source","loading"]),t(y,{class:"mt-2",onClick:oe},{default:l(()=>[...e[9]||(e[9]=[F("Add attraction",-1)])]),_:1})]),_:1})]),_:1},8,["form","model"]),t(j(we),{fileTypes:["jpg","jpeg","png"],multiple:!1,onSuccess:ue},{default:l(({openFileSelector:n})=>{var i;return[be("div",{class:"rounded overflow-hidden cursor-pointer",onClick:n},[(i=r.value)!=null&&i.image?(v(),C("img",{key:0,src:r.value.image,alt:"preview",class:"w-full h-auto object-cover"},null,8,Ue)):(v(),C("div",Ne," Upload Image "))],8,Ie)]}),_:1}),t(q,{open:b.value,"onUpdate:open":e[4]||(e[4]=n=>b.value=n),title:"Add Attraction",onOk:le,loading:A.value,onCancel:se},{default:l(()=>[t(M,{form:J.value,model:g,rules:W,layout:"vertical"},{default:l(()=>[t(D,{label:"Attraction Name",name:"attraction_name"},{default:l(()=>[t(z,{value:g.attraction_name,"onUpdate:value":e[2]||(e[2]=n=>g.attraction_name=n),placeholder:"Enter attraction name"},null,8,["value"])]),_:1}),t(D,{label:"Type",name:"type"},{default:l(()=>[t(T,{value:g.type,"onUpdate:value":e[3]||(e[3]=n=>g.type=n),options:I,placeholder:"Select type"},null,8,["value"])]),_:1})]),_:1},8,["form","model"])]),_:1},8,["open","loading"])]),_:1},8,["open","title","loading"])],64)}}};export{Ee as default};
//# sourceMappingURL=DestinationList-Ck_QReea.js.map
