{"version":3,"file":"ActivityList-CMfmpFF5.js","sources":["../../../../frontend/src/pages/ActivityList.vue"],"sourcesContent":["<template>\n    <a-page-header class=\"!p-0 !mb-2\" title=\"Activities\">\n        <template #extra>\n            <a-button type=\"primary\" @click=\"handleCreate\">Create activity</a-button>\n        </template>\n    </a-page-header>\n    <a-table :columns=\"columns\" :data-source=\"activities.data\" size=\"small\" :loading=\"activities.list.loading\"\n        :pagination=\"false\" row-key=\"name\" :scroll=\"{ y: 'calc(100vh - 280px)' }\">\n        <template #bodyCell=\"{ column, record }\">\n            <template v-if=\"column.dataIndex === 'cost'\">\n                <div>\n                    ${{ record.cost }}\n                </div>\n            </template>\n            <template v-if=\"column.key === 'Action'\">\n                <div class=\"editable-row-operations\">\n                    <div class=\"flex gap-2\">\n                        <a-button @click=\"edit(record.name)\" type=\"primary\" class=\"!flex justify-center items-center\">\n                            <template #icon>\n                                <FeatherIcon name=\"edit\" class=\"size-4\" />\n                            </template>\n                        </a-button>\n                        <a-button @click=\"deleteRecord(record.name)\" type=\"primary\"\n                            class=\"!flex justify-center items-center\" danger>\n                            <template #icon>\n                                <FeatherIcon name=\"trash-2\" class=\"size-4\" />\n                            </template>\n                        </a-button>\n                    </div>\n                </div>\n            </template>\n        </template>\n    </a-table>\n    <a-modal v-model:open=\"open\" :title=\"isCreate ? 'Create Activity' : `Activity: ${formModel?.activity_name || ''}`\"\n        @ok=\"handleSave\" :loading=\"saving\" @cancel=\"handleCancel\">\n        <a-form :form=\"createFormRef\" :model=\"formModel\" :rules=\"formRules\" layout=\"vertical\">\n            <a-form-item label=\"Activity Name\" name=\"activity_name\">\n                <a-input v-model:value=\"formModel.activity_name\" placeholder=\"Enter activity name\" />\n            </a-form-item>\n            <a-form-item label=\"Cost\" name=\"cost\">\n                <a-input-number v-model:value=\"formModel.cost\" placeholder=\"Enter cost\" class=\"!w-full\" />\n            </a-form-item>\n            <a-form-item label=\"Description\" name=\"description\">\n                <a-textarea v-model:value=\"formModel.description\" placeholder=\"Enter cost\" class=\"!w-full\" />\n            </a-form-item>\n            <a-form-item label=\"Destinations\" name=\"destinations\">\n                <a-select v-model:value=\"formModel.destinations\" :options=\"destinationOptions\" mode=\"multiple\"\n                    class=\"!w-full\" placeholder=\"Please select\" />\n            </a-form-item>\n        </a-form>\n    </a-modal>\n</template>\n\n<script setup>\nimport { ref, reactive, nextTick, computed } from 'vue';\nimport { message } from 'ant-design-vue';\nimport { ActivityStore } from '@/data/Activities';\nimport { DestinationStore } from '@/data/destinations';\nimport { createDocumentResource } from 'frappe-ui'\n\nconst { destinations } = DestinationStore()\nconst destinationOptions = computed(() => {\n    return destinations?.data?.map(d => ({\n        value: d.name,\n        label: d.destination_name\n    })) || []\n})\n\nconst { activities } = ActivityStore()\nconst open = ref(false)\nconst saving = ref(false)\nconst isCreate = ref(false)\nconst activityName = ref('')\n\nconst activity = createDocumentResource({\n    doctype: 'Activity',\n    name: activityName,\n    auto: false\n})\n\nconst createFormRef = ref(null)\n\nconst formModel = ref(null)\n\nconst formRules = {\n    activity_name: [{ required: true, message: 'Please enter activity name' }],\n    cost: [{ required: true, message: 'Please enter cost' }, { type: 'number', min: 0, message: 'Cost must be at least 0' }],\n    destinations: [{ required: true, type: 'array', min: 1, message: 'Please select at least one destination' }]\n};\n\nconst handleCreate = async () => {\n    try {\n        isCreate.value = true\n        formModel.value = reactive({\n            activity_name: '',\n            cost: 0,\n            destinations: []\n        })\n        open.value = true\n    } catch (error) {\n        console.error('Setup create error:', error)\n    }\n}\n\nconst edit = async (name) => {\n    try {\n        isCreate.value = false\n        activityName.value = name\n        activity.name = name\n        await activity.reload()\n        formModel.value = activity.doc\n        formModel.value.destinations = activity.doc.destination_child.map(child => child.destination)\n        open.value = true\n    } catch (error) {\n        message.error({ content: error.message, duration: 5 })\n    }\n}\n\nconst handleCancel = () => {\n    open.value = false\n}\n\nconst handleSave = async () => {\n    try {\n        saving.value = true\n        if (isCreate.value) {\n            const childTable = formModel.value.destinations.map(dest => ({ destination: dest }))\n            await activities.insert.submit({ ...formModel.value, destination_child: childTable })\n            message.success('Activity created successfully', 2)\n        } else {\n            activity.doc.destination_child.splice(0, activity.doc.destination_child.length)\n            formModel.value.destinations.forEach(dest => {\n                activity.doc.destination_child.push({ destination: dest })\n            })\n            await activity.save.submit()\n            message.success('Activity updated successfully', 2)\n        }\n        await activities.reload()\n        open.value = false\n    } catch (error) {\n        if (error.errorFields) {\n            message.error('Please fix the errors below', 2)\n        } else {\n            message.error('Failed to save activity', 2)\n            console.error('Save error:', error)\n        }\n    } finally {\n        saving.value = false\n    }\n}\n\nconst deleteRecord = async (name) => {\n    try {\n        await activities.delete.submit(name)\n        await activities.reload()\n        message.success('Successfully deleted activity', 2)\n    } catch (error) {\n        message.error(error.message || 'Failed to delete activity', 2)\n    }\n}\n\nconst columns = [\n    {\n        title: 'Activity name',\n        key: 'activity_name',\n        dataIndex: 'activity_name'\n    },\n    {\n        title: 'Cost',\n        key: 'cost',\n        dataIndex: 'cost',\n        width: '25%'\n    },\n    {\n        title: 'Description',\n        key: 'description',\n        dataIndex: 'description',\n    },\n    {\n        title: 'Action',\n        key: 'Action',\n        width: '15%'\n    }\n]\n</script>"],"names":["destinations","DestinationStore","destinationOptions","computed","_a","d","activities","ActivityStore","open","ref","saving","isCreate","activityName","activity","createDocumentResource","createFormRef","formModel","formRules","handleCreate","__async","reactive","error","edit","name","child","message","handleCancel","handleSave","childTable","dest","__spreadProps","__spreadValues","deleteRecord","columns","_createVNode","_component_a_page_header","_component_a_button","_cache","_component_a_table","_unref","_withCtx","column","record","_openBlock","_createElementBlock","_hoisted_1","_toDisplayString","_hoisted_2","_createElementVNode","_hoisted_3","$event","_component_FeatherIcon","_component_a_modal","_component_a_form","_component_a_form_item","_component_a_input","_component_a_input_number","_component_a_textarea","_component_a_select"],"mappings":"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"}